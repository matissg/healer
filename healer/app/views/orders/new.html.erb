<h1 class="text-3xl font-bold text-gray-800 mb-6">Create a New Order</h1>

<div class="bg-white shadow rounded-lg p-6 max-w-md mx-auto">
  <%= form_with(model: @order, local: true, class: "space-y-6") do |form| %>
    
    <div>
      <%= form.label :user_id, "User", class: "block text-gray-700 font-medium mb-2" %>
      <%= form.collection_select :user_id, @users, :id, :name, {}, 
        class: "block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 p-2" %>
    </div>

    <div>
      <%= form.label :product_name, "Product", class: "block text-gray-700 font-medium mb-2" %>
      <select name="product_name"
              class="block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 p-2"
              data-controller="product"
              data-action="change->product#updatePrice"
              data-product-products="<%= @products.map { |p| { name: p.name, price: p.price } }.to_json %>">
        <option value="">Select a product</option>
        <% @products.each do |product| %>
          <option value="<%= product.name %>"><%= product.name %></option>
        <% end %>
      </select>
    </div>

    <!-- Display Product Price on Product change -->
    <p class="text-gray-700 mt-2">Price: <span id="price_display">Select a product</span></p>

    <!-- Hidden Input for Price -->
    <%= form.hidden_field :price, id: "product_price_field" %>

    <div>
      <%= form.label :total, "Order Total", class: "block text-gray-700 font-medium mb-2" %>
      <%= form.number_field :total, step: 0.01, 
        class: "block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 p-2" %>
    </div>

    <div>
      <%= form.submit "Create Order", class: "w-full bg-blue-600 text-white font-semibold py-2 px-4 rounded-md hover:bg-blue-700" %>
    </div>
    
  <% end %>
</div>
